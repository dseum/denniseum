<!DOCTYPE html>
<html>

<head>
    <title>CONTACT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="Dennis Eum: send an email to me and communicate. request a full copy of my resume here.">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">

    <!-- external stylesheets -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- main stylesheet -->
    <link rel="stylesheet" href="main.css">

    <!-- scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/fdddb9628d.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- navbar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#"><b>DENNIS EUM</b></a>
        <div class="navbar-toggler" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
            aria-expanded="false" aria-label="Toggle navigation">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">HOME </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="about.html">ABOUT</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="portfolio.html">PORTFOLIO</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="contact.html">CONTACT<span class="sr-only">(current)</span></a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- main body -->
    <div class="container-md">
        <div class="row row-eq-height">
            <div class="col-md-4">
                <div class="card custom-card">
                    <div class="card-body">
                        <h3 class="card-title">CONTACT</h3>
                        <p class="card-text">
                            <img src="images/contact_minor.jpg" class="img img-fluid minor"
                                alt="dennis eum personal photo">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card custom-card">
                    <div class="card-body">
                        <h5 class="card-title">Send a message:</h5>
                        <p class="card-text">
                        <form class="needs-validation" id="sendMsg" novalidate>
                            <fieldset id="sendMsgFields">
                                <div class="form-row">
                                    <div class="form-group col-md">
                                        <input type="text" class="form-control" id="firstname" placeholder="First name"
                                            required>
                                    </div>
                                    <div class="form-group col-md">
                                        <input type="text" class="form-control" id="lastname" placeholder="Last name"
                                            required>
                                    </div>
                                    <div class="form-group col-md">
                                        <input type="email" class="form-control" id="email"
                                            placeholder="name@example.com" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <textarea class="form-control" id="msg" rows="3" placeholder="Message"
                                        required></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-3 mb-3">
                                        <label id="verifyset" for="verifycode"></label>
                                        <input type="text" class="form-control" id="verifycode" placeholder="Code"
                                            required>
                                    </div>
                                </div>
                                <button class="btn btn-primary align-middle" type="submit" id="submit-btn">Send
                                    email</button>
                            </fieldset>
                        </form>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <p class="text-center">dennis eum &copy; <span id="year"></span></p>
        <div style="padding-bottom: 10px;"></div>
    </div>
    <script>
        // JQuery
        var verifyset = reloadVerification();
        $(document).ready(function () {
            // set copyright year
            $('#year').text(new Date().getFullYear());

            // toggle navbar
            $('.navbar-toggler').click(function () {
                $('.navbar, .navbar-brand, .container-md').toggleClass('tint');
            });

            // toggle card lists
            $(".li-toggler").click(function () {
                $(this).next(".li-desc").fadeToggle(300);
                $(this).children(".fas").toggleClass("fa-rotate-180");
            });

            // setup form
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {
                    checkCode();
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    } else {
                        event.preventDefault();
                        runFormScript();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        });

        function getRandomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }

        function reloadVerification() {
            const a = getRandomInt(9);
            const b = getRandomInt(9);
            $('#verifyset').text(`What is ${a.toString()} times ${b.toString()}?`);
            return [a, b];
        }

        function formAlert(message) {
            $('#sendMsg').parent().append(`<div class="alert alert-${message[0]}" role="alert">${message[1]} <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button></div>`);
        }

        function runFormScript() {
            // gapps jquery code
            $('#verifycode')[0].setCustomValidity('');
            $('#sendMsgFields').prop('disabled', true);
            $('#submit-btn').html('<div class="spinner-border text-secondary" role="status"><span class="sr-only">Loading...</span></div>');
            let data = {
                firstname: $('#firstname').val(),
                lastname: $('#lastname').val(),
                email: $('#email').val(),
                msg: $('#msg').val()
            };
            let url = 'https://script.google.com/macros/s/AKfycbwkumWHfN4lYKrulteTtmqaSd8JcBvzrLpcfb_S7I0Y2fbd7Kgt/exec';
            fetch(url, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                credentials: 'omit',
                redirect: 'follow',
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
            }).then(response => {
                formAlert(['success', 'Success: The response was submitted!']);
                // reset form
                $('#sendMsg').trigger('reset').removeClass('was-validated');
                verifyset = reloadVerification();
                $('#sendMsgFields').prop('disabled', false);
                $('#submit-btn').html('Send email');
            }).catch(err => {
                formAlert(['danger', `Error: ${err}`]);
                $('#sendMsgFields').prop('disabled', false);
                $('#submit-btn').html('Send email');
            });
        }

        function checkCode() {
            let verifycode = $('#verifycode');

            if ((verifyset[0] * verifyset[1]) == parseInt(verifycode.val())) {
                verifycode[0].setCustomValidity("");
            }
            else {
                verifycode[0].setCustomValidity('Invalid.');
                formAlert(['danger', 'Error: Verification was unsuccessful. Please check your math again.']);
            }
        }
    </script>
</body>

</html>